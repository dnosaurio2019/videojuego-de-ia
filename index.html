<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cavernas de Ne√≥n ‚Äî Versi√≥n Web</title>
  <style>
    :root{
      --bg:#080812; --neon:#00ffd3; --accent:#ff59a6; --muted:#a6a6c8;
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial;background:linear-gradient(180deg,#020214 0%, #081026 60%);}    
    .wrap{max-width:1000px;margin:18px auto;padding:18px;color:var(--muted);} 
    h1{color:var(--neon);margin:0 0 8px;font-weight:700}
    p.lead{color:#cfeef0;margin:0 0 12px}
    #gameContainer{display:flex;gap:20px;align-items:flex-start}
    canvas{background:#06061a;border:4px solid rgba(0,255,211,0.06);box-shadow:0 8px 40px rgba(0,0,0,0.6);}
    .sidebar{width:300px;color:var(--muted)}
    .panel{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;margin-bottom:12px}
    .stat{display:flex;justify-content:space-between;margin:6px 0}
    .btn{display:inline-block;padding:8px 12px;border-radius:6px;background:linear-gradient(90deg,#0ff 0%, #a0f 100%);color:#041018;font-weight:700;text-decoration:none}
    footer{color:#546; font-size:12px;margin-top:12px}
    .small{font-size:13px;color:#9aa}
    /* HUD inside canvas fallback */
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üåå Cavernas de Ne√≥n ‚Äî Web</h1>
    <p class="lead">Aventura futurista-surrealista: controla a <strong>Kael Voryn</strong>, un explorador que debe atravesar cuevas biocibern√©ticas, derrotar monstruos y recuperar el <em>N√∫cleo de Medalla</em>. Usa las flechas para moverte, ESPACIO para el Puls o de Resonancia (habilidad especial).</p>

    <div id="gameContainer">
      <canvas id="game" width="800" height="600"></canvas>

      <div class="sidebar">
        <div class="panel">
          <h3 style="margin:0;color:var(--neon)">Historia de Fondo</h3>
          <p class="small">A√±o 3125: tras la Gran Hibernaci√≥n de las inteligencias, el mundo exterior es ceniza. En el subsuelo, redes antiguas palpitan: las Cuevas de Ne√≥n. El N√∫cleo de Medalla es una reliquia que puede sincronizar plantas y m√°quinas para restaurar la biosfera. Kael Voryn, portador de una pr√≥tesis sensorial, debe recuperarlo.</p>
        </div>

        <div class="panel">
          <h4 style="margin:0;color:var(--neon)">Personajes & Roles</h4>
          <div class="small">
            <strong>Kael Voryn</strong> ‚Äî Explorador (jugador). Pulso de Resonancia: desactiva enemigos por breve tiempo. Rol: scout/interruptor.
            <hr>
            <strong>Syl (IA aliada)</strong> ‚Äî Voz en el casco: da consejos y pistas.
            <hr>
            <strong>Spectroide</strong> ‚Äî Enemigo r√°pido, da√±a con toques.
            <hr>
            <strong>G√≥lem de Cables</strong> ‚Äî Lento, alto HP. Empuja y ralentiza.
          </div>
        </div>

        <div class="panel">
          <h4 style="margin:0;color:var(--neon)">Controles</h4>
          <div class="small">
            <div class="stat"><span>Mover</span><span>‚Üë ‚Üì ‚Üê ‚Üí</span></div>
            <div class="stat"><span>Pulso</span><span>SPACE (cooldown)</span></div>
            <div class="stat"><span>Dash</span><span>Shift</span></div>
          </div>
        </div>

        <div class="panel">
          <h4 style="margin:0;color:var(--neon)">C√≥mo ejecutar</h4>
          <p class="small">Guarda este archivo como <code>cavernas_de_neon_web.html</code> y √°brelo en tu navegador (Chrome/Edge/Firefox). Para mejor desarrollo, usa Live Server en VS Code.</p>
          <a class="btn" id="startBtn">Iniciar / Reiniciar</a>
        </div>

        <footer>Dise√±ado para jugar en navegador ‚Äî m√∫sica generada por WebAudio. ¬© Cavernas de Ne√≥n</footer>
      </div>
    </div>
  </div>

  <script>
  // Juego en canvas: mec√°nicas b√°sicas, enemigos, habilidades, HUD
  (function(){
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    // Estado del juego
    let keys = {};
    let lastTime = 0;
    let entities = [];
    let player;
    let gameRunning = false;

    // Sonidos simples con WebAudio
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const audioCtx = AudioCtx ? new AudioCtx() : null;
    function beep(freq=440, dur=0.08, type='sine', vol=0.08){
      if(!audioCtx) return;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type; o.frequency.value = freq;
      g.gain.value = vol;
      o.connect(g); g.connect(audioCtx.destination);
      o.start(); o.stop(audioCtx.currentTime + dur);
    }

    // Util
    function rand(min,max){ return Math.random()*(max-min)+min }

    // Clases
    class Entity{
      constructor(x,y,w,h){ this.x=x;this.y=y;this.w=w;this.h=h; this.dead=false }
      intersects(other){ return !(this.x+this.w<other.x || this.x>other.x+other.w || this.y+this.h<other.y || this.y>other.y+other.h) }
      update(dt){}
      draw(ctx){}
    }

    class Player extends Entity{
      constructor(){ super(80, H/2 - 20, 40, 40);
        this.speed = 200; this.color = '#00ffd3'; this.maxLife=120; this.life=this.maxLife;
        this.pulseReady=true; this.pulseTimer=0; this.pulseCooldown=3.5; this.pulseDuration=0.9;
        this.pulseActive=false; this.dash=false; this.dashTimer=0; this.dashCooldown=1.2;
      }
      update(dt){
        // Movement
        let vx=0, vy=0;
        if(keys.ArrowUp) vy -=1; if(keys.ArrowDown) vy +=1; if(keys.ArrowLeft) vx -=1; if(keys.ArrowRight) vx +=1;
        const norm = Math.hypot(vx,vy) || 1;
        let sp = this.speed * (this.dash? 2.1 : 1);
        this.x += (vx/norm) * sp * dt;
        this.y += (vy/norm) * sp * dt;
        // Bounds
        this.x = Math.max(0, Math.min(W-this.w, this.x));
        this.y = Math.max(0, Math.min(H-this.h, this.y));

        // Pulse cooldown
        if(!this.pulseReady){ this.pulseTimer += dt; if(this.pulseTimer >= this.pulseCooldown){ this.pulseReady=true; this.pulseTimer=0; } }
        if(this.pulseActive){ this.pulseDuration -= dt; if(this.pulseDuration <= 0){ this.pulseActive=false; this.pulseDuration=0.9 } }

        // Dash cooldown
        if(this.dash){ this.dashTimer += dt; if(this.dashTimer>=0.22){ this.dash=false; this.dashTimer=0; } }

      }
      draw(ctx){
        // Glow
        ctx.shadowBlur = 18; ctx.shadowColor = '#00ffd3';
        ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.w, this.h);
        ctx.shadowBlur = 0;
        // pulse ring
        if(this.pulseActive){ ctx.beginPath(); ctx.strokeStyle='rgba(0,255,211,0.28)'; ctx.lineWidth=6; ctx.arc(this.x+this.w/2, this.y+this.h/2, 70, 0, Math.PI*2); ctx.stroke(); }
      }
    }

    class Enemy extends Entity{
      constructor(x,y,type='spectroide'){
        super(x,y,36,36); this.type=type; this.vx = (type=='spectroide'? -120 : -60); this.color = (type=='spectroide'? '#b04cff' : '#ff5a6b');
        this.hp = (type=='spectroide'? 15 : 45); this.stunned = 0;
      }
      update(dt){
        if(this.stunned>0){ this.stunned -= dt; return }
        this.x += this.vx * dt;
        // simple wrap: respawn to right
        if(this.x + this.w < -20){ this.x = W + rand(40,260); this.y = rand(40, H-80); this.hp = (this.type=='spectroide'?15:45); }
      }
      draw(ctx){ ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.w, this.h); }
    }

    // Goal
    const portal = {x: W-90, y: H/2-70, w:80, h:140};

    // Game functions
    function spawnEnemies(n=5){
      for(let i=0;i<n;i++){
        const t = Math.random()<0.6? 'spectroide' : 'golem';
        const e = new Enemy(W + rand(20,600), rand(40,H-80), t); entities.push(e);
      }
    }

    function reset(){ entities = []; player = new Player(); entities.push(player); spawnEnemies(6); gameRunning=true; lastTime=performance.now(); if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); }

    function playerPulse(){ if(!player.pulseReady) return; player.pulseReady=false; player.pulseActive=true; player.pulseDuration=0.9; beep(880,0.06,'sine',0.06);
      // stun enemies in radius
      entities.forEach(e=>{ if(e instanceof Enemy){ const dx = (e.x+e.w/2) - (player.x+player.w/2); const dy = (e.y+e.h/2) - (player.y+player.h/2); const d = Math.hypot(dx,dy); if(d < 140){ e.stunned = 1.4; } } });
    }

    function applyCollisions(dt){
      for(const e of entities){ if(e instanceof Enemy){ if(player.intersects(e) && e.stunned<=0){ // collision damage
            const dmg = (e.type=='spectroide'? 8 : 22) * dt * 6; // scaled to time
            player.life -= dmg;
            // push back
            player.x += 6 * Math.sign(player.x - e.x);
            beep(180 + Math.random()*240,0.03,'square',0.06);
            if(player.life <= 0){ player.life = 0; gameOver(false); }
          } }
      }
    }

    let won = false;
    function gameOver(victory){ gameRunning=false; won = !!victory; }

    // Draw HUD
    function drawHUD(ctx){
      // life bar
      ctx.fillStyle = 'rgba(255,255,255,0.06)'; ctx.fillRect(14,14,220,28);
      const lifeFrac = player.life / player.maxLife;
      const grd = ctx.createLinearGradient(14,14,234,14); grd.addColorStop(0,'#00ffb3'); grd.addColorStop(1,'#ff5a6b');
      ctx.fillStyle = grd; ctx.fillRect(14,14, Math.max(0, 220*lifeFrac), 28);
      ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.strokeRect(14,14,220,28);
      ctx.fillStyle='#cfeef0'; ctx.font='14px Inter, Arial'; ctx.fillText('Vida: ' + Math.round(player.life), 18, 33);

      // pulse cooldown
      ctx.fillStyle='rgba(255,255,255,0.03)'; ctx.fillRect(14,52,220,18);
      const pulseFrac = player.pulseReady?1: (player.pulseTimer / player.pulseCooldown);
      ctx.fillStyle = player.pulseReady? '#7ef2d6' : '#666'; ctx.fillRect(14,52,220*Math.min(1,pulseFrac),18);
      ctx.fillStyle='#cfeef0'; ctx.fillText(player.pulseReady? 'Pulso listo (SPACE)' : 'Pulso: recargando', 18, 66);

      // goal indicator
      ctx.fillStyle='#ffea6a'; ctx.fillRect(W-110, 18, 96, 22);
      ctx.fillStyle='#041018'; ctx.fillText('N√∫cleo ‚Äî Llega aqu√≠', W-100, 33);

      // simple minimap dot
      ctx.fillStyle='rgba(255,255,255,0.04)'; ctx.fillRect(W-140, H-80, 120, 60);
      ctx.fillStyle='#00ffd3'; ctx.fillRect(W-130, H-60, 8, 8);
    }

    // Main loop
    function loop(t){
      if(!gameRunning){ renderEnd(); return }
      const dt = Math.min(0.05, (t - lastTime)/1000); lastTime = t;
      update(dt); render(); requestAnimationFrame(loop);
    }

    function update(dt){
      entities.forEach(e=>e.update(dt));
      applyCollisions(dt);
      // check arrival at portal
      if(player.x + player.w > portal.x && player.y + player.h/2 > portal.y && player.y < portal.y + portal.h){ gameOver(true); }
    }

    function render(){
      // background
      ctx.clearRect(0,0,W,H);
      // surreal cave: moving gradient & lines
      const g = ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,'#040419'); g.addColorStop(1,'#0b1026'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

      // decorative neon veins
      for(let i=0;i<6;i++){ ctx.strokeStyle = i%2? 'rgba(160,80,255,0.06)' : 'rgba(0,255,211,0.04)'; ctx.lineWidth = (i%2?1:2); ctx.beginPath(); ctx.moveTo(0, 60 + i*80); ctx.bezierCurveTo(W*0.3, 40 + i*60, W*0.6, 120 + i*40, W, 60 + i*80); ctx.stroke(); }

      // draw portal
      ctx.save(); ctx.translate(portal.x + portal.w/2, portal.y + portal.h/2);
      ctx.rotate((Date.now()%2000)/2000 * Math.PI*2);
      ctx.fillStyle='rgba(255,230,80,0.12)'; ctx.fillRect(-portal.w/2, -portal.h/2, portal.w, portal.h);
      ctx.restore();

      // entities
      entities.forEach(e=>e.draw(ctx));

      // overlay text
      drawHUD(ctx);

      // if pulse active, draw ripple particles
      if(player.pulseActive){ for(let i=0;i<8;i++){ ctx.beginPath(); ctx.strokeStyle='rgba(0,255,211,0.05)'; ctx.lineWidth=2; ctx.arc(player.x+player.w/2, player.y+player.h/2, 30 + i*12 + ((Date.now()%300)/300*8), 0, Math.PI*2); ctx.stroke(); } }
    }

    function renderEnd(){
      // show end screen
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle='#040419'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle= won? '#b8ffd7' : '#ffb3c7'; ctx.font='28px Inter, Arial'; ctx.fillText(won? '‚ú® ¬°Kael ha restaurado la semilla!' : '‚ò†Ô∏è Kael cay√≥ en las profundidades...', 80, H/2 - 20);
      ctx.fillStyle='#cfeef0'; ctx.font='16px Inter, Arial'; ctx.fillText(won? 'El N√∫cleo de Medalla vibra con nueva vida.' : 'Las m√°quinas suspiran en la oscuridad.', 80, H/2 + 12);
      ctx.fillStyle='#9aa'; ctx.font='13px Inter, Arial'; ctx.fillText('Presiona Iniciar para jugar de nuevo', 80, H/2 + 56);
    }

    // Input
    window.addEventListener('keydown', (e)=>{ keys[e.key] = true;
      if(e.key === ' '){ e.preventDefault(); if(gameRunning) playerPulse(); }
      if(e.key === 'Shift'){ if(gameRunning && !player.dash){ player.dash=true; beep(520,0.05,'square',0.06); } }
    });
    window.addEventListener('keyup', (e)=>{ keys[e.key] = false; });

    // Start button
    document.getElementById('startBtn').addEventListener('click', ()=>{ reset(); requestAnimationFrame(loop); });

    // Autostart once loaded
    reset(); requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>
